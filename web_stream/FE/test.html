<!DOCTYPE html>
<html>
<head>
    <title>Live_Frame_Extraction</title>
</head>
<body>
    <video id="video" autoplay></video>
    <canvas id="canvas" width="256" height="256"></canvas>

    <script>

        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let context = canvas.getContext('2d');

        let constraints = {
            video: {
                facingMode: "user", 
                width: { ideal: 256 },
                height: { ideal: 256 } 
            }
        };

        navigator.mediaDevices.getUserMedia(constraints)
            .then(function(stream) {

                video.srcObject = stream;

                video.play();
            })
            .catch(function(err) {
                console.log('Error: ' + err);
            });

        setInterval(async function() {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            let imageData = context.getImageData(0, 0, canvas.width, canvas.height);

            let dataUrl = canvas.toDataURL('image/png');
            let base64Data = dataUrl.split(',')[1]; 

            let response = await fetch('http://127.0.0.1:8000/receive_frame/', {  //change the url to bakend url to receive frames
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ image: base64Data })
            });

            if (!response.ok) {
                console.log('no response');
            }

        }, 1);

    </script>
</body>
</html>
